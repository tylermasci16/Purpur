From 0000000000000000000000000000000000000000 Mon Sep 17 00:00:00 2001
From: tylermasci <mascityler@gmail.com>
Date: Thu, 9 Jun 2022 03:41:32 -0400
Subject: [PATCH] fix antimalware


diff --git a/src/main/java/com/gmail/mascityler/antimalware/AntiMalwareDriver.java b/src/main/java/com/gmail/mascityler/antimalware/AntiMalwareDriver.java
index 4770577766006fbda403a2c1a0afbc7f725d7660..baed4ae6fb0e0780f7bb6bff38879c20e773f6c2 100644
--- a/src/main/java/com/gmail/mascityler/antimalware/AntiMalwareDriver.java
+++ b/src/main/java/com/gmail/mascityler/antimalware/AntiMalwareDriver.java
@@ -23,16 +23,23 @@ public class AntiMalwareDriver {
     private static boolean istransformed=false;
 
     public static void trans() {
-        if (inst != null && istransformed) {
-            Transformers.a(() -> null);
-        }
+        //if (inst != null && istransformed) {
+           //Transformers.a(() -> null);
+
+        CallerInfo callerInfo = RuntimeUtils.getCallerInfo();
+        if (callerInfo != null && AntiMalware.getInstance().getCheckManager().isPluginJarBlacklisted(callerInfo.getPlugin().getJar())) {
+            throw new FormattedSecurityException(I18n.tl("might_be_malicious", new Object[]{callerInfo.getPlugin().getJar()}));
+            }
     }
 
 
 
     public static void hashmapinterceptor() {
         if (inst != null && istransformed) {
-            Transformers.d(() -> null);
+            CallerInfo callerInfo = RuntimeUtils.getCallerInfo();
+            if (callerInfo != null && AntiMalware.getInstance().getCheckManager().isPluginJarBlacklisted(callerInfo.getPlugin().getJar())) {
+                throw new FormattedSecurityException(I18n.tl("transformer_plugin_might_be_malicious", new Object[]{callerInfo.getPlugin().getJar()}));
+            }
         }
     }
     private static boolean ran=false;
